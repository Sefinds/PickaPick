<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="../manifest.json">
  <script src="../main.js"></script>
  <!--Links-->
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
  <link rel="stylesheet" href="register1.css">
  <title>register</title>
</head>

<body>
  <div onload="myFunction">

    <div class="wrapper-1">
      <div class="wrapperitem-1">
        <span class="titulo">Almost finished! </span> <br>
        <span class="subtitulo">Just choose your name and Pick a Pick</span>
      </div><br><br><br><br>

      <div class="wrapperitem-1">
        <div class="username">
          <input id="username" type="text" class="text-line" placeholder="Username" required>
        </div>
      </div>
    </div><br><br><br><br>


    <div class="wrapper-2">
      <div class="wrapperitem-2">
        <button id="1">
          <img id="pinki" src="" style="max-width:100%; max-height:100%;">
        </button>
      </div>

      <div class="wrapperitem-2">
        <button id="2">
          <img id="bubble" src="" style="max-width:100%; max-height:100%;">
        </button>
      </div>

      <div class="wrapperitem-2">
        <button id="3">
          <img id="miss" src="" style="max-width:100%; max-height:100%;">
        </button>
      </div>

      <div class="wrapperitem-2">
        <button id="4">
          <img id="poop" src="" style="max-width:100%; max-height:100%;">
        </button>
      </div>

      <div class="wrapperitem-2">
        <button id="5">
          <img id="blue" src="" style="max-width:100%; max-height:100%;">
        </button>
      </div>

      <div class="wrapperitem-2">
        <button id="6">
          <img id="rob" src="" style="max-width:100%; max-height:100%;">
        </button>
      </div>
    </div>

    <br><br>
    <div class="wrapper-1">
      <div class="wrapperitem-1">
        <a id="letsgo" class="letsgo" style="text-decoration: none;">
          <div class="letsgo-color">
            <div class="letsgo-box">
              <span class="letsgo-text" style="line-height: 50px;">Letâ€™s Go</span>
            </div>
          </div>
        </a>
      </div>
    </div>

    <!--<span class="trespontos">..</span>-->
  </div>


  <script src="../firebase.js" type="module"></script>

  <script type="module">
    import {
      auth,
      db,
      user
    } from "../firebase.js";
    import {
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      doc,
      setDoc,
      updateDoc,
      getDocs,
      onSnapshot,
      getDoc
    } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-firestore.js";
    import {
      getStorage,
      ref,
      uploadBytesResumable,
      getDownloadURL,
      getMetadata
    } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-storage.js";

    //buscar imagens da storage e fazer output delas
    function myFunction() {
      const storage = getStorage();
      //const mountainsRef = ref(storage, 'Picks/Pinki.png');
      //const pinki = 'Pinki.png';

      const pinki = doc(db, 'Picks', 'Pinki');
      getDoc(pinki).then(pink => {
        if (pink.exists()) {
          //localStorage.setItem('Picks', JSON.stringify(pinki.data()));
          const pinkpdoc = document.getElementById('pinki');
          pinkpdoc.setAttribute('src', pink.data().img);
          //  document.getElementById('pinki').setAttribute = ('src', pink.data().img);
          document.getElementById('1').style.backgroundColor = (pink.data().imgcolor);
          document.getElementById('1').style.borderColor = (pink.data().bordercolor);

          document.getElementById("1").addEventListener('click', (e) => {
            sessionStorage.setItem('pick', JSON.stringify(pink.data()));
          });

        } else {
          console.log('Este produto nao existe.');
        }
      });

      const bubble = doc(db, 'Picks', 'Bubble');
      getDoc(bubble).then(bubb => {
        if (bubb.exists()) {
          const bubbleimg = document.getElementById('bubble');
          bubbleimg.setAttribute('src', bubb.data().img);
          document.getElementById('2').style.backgroundColor = (bubb.data().imgcolor);
          document.getElementById('2').style.borderColor = (bubb.data().bordercolor);
          document.getElementById("2").addEventListener('click', (e) => {
            sessionStorage.setItem('pick', JSON.stringify(bubb.data()));
            console.log(bubb.data());
          });
        } else {
          console.log('Este produto nao existe.');
        }
      });

      const miss = doc(db, 'Picks', 'Miss');
      getDoc(miss).then(mis => {
        if (mis.exists()) {
          const missimg = document.getElementById('miss');
          missimg.setAttribute('src', mis.data().img);
          document.getElementById('3').style.backgroundColor = (mis.data().imgcolor);
          document.getElementById('3').style.borderColor = (mis.data().bordercolor);
          document.getElementById("3").addEventListener('click', (e) => {
            sessionStorage.setItem('pick', JSON.stringify(mis.data()));
          });
        } else {
          console.log('Este produto nao existe.');
        }
      });

      const poop = doc(db, 'Picks', 'Poop');
      getDoc(poop).then(poo => {
        if (poo.exists()) {
          const poopimg = document.getElementById('poop');
          poopimg.setAttribute('src', poo.data().img);
          document.getElementById('4').style.backgroundColor = (poo.data().imgcolor);
          document.getElementById('4').style.borderColor = (poo.data().bordercolor);
          document.getElementById("4").addEventListener('click', (e) => {
            sessionStorage.setItem('pick', JSON.stringify(poo.data()));
          });
        } else {
          console.log('Este produto nao existe.');
        }
      });

      const blue = doc(db, 'Picks', 'Blue');
      getDoc(blue).then(blu => {
        if (blu.exists()) {
          const blueimg = document.getElementById('blue');
          blueimg.setAttribute('src', blu.data().img);
          document.getElementById('5').style.backgroundColor = (blu.data().imgcolor);
          document.getElementById('5').style.borderColor = (blu.data().bordercolor);
          document.getElementById("5").addEventListener('click', (e) => {
            sessionStorage.setItem('pick', JSON.stringify(blu.data()));
          });
        } else {
          console.log('Este produto nao existe.');
        }
      });

      const rob = doc(db, 'Picks', 'Rob');
      getDoc(rob).then(ro => {
        if (ro.exists()) {
          const robimg = document.getElementById('rob');
          robimg.setAttribute('src', ro.data().img);
          document.getElementById('6').style.backgroundColor = (ro.data().backgroundColor);
          document.getElementById('6').style.borderColor = (ro.data().bordercolor);
          document.getElementById("6").addEventListener('click', (e) => {
            sessionStorage.setItem('pick', JSON.stringify(ro.data()));
          });
        } else {
          console.log('Este produto nao existe.');
        }
      });

    }
    console.log(myFunction())
    window.myFunction = myFunction;

    document.getElementById("letsgo").addEventListener('click', (e) => {
      var username = document.getElementById('username').value;
      var pick = JSON.parse(sessionStorage.getItem('pick'));
      var img = (pick.img);
      var imgcolor = (pick.imgcolor);
      var bordercolor = (pick.bordercolor);
      console.log(username);

      onAuthStateChanged(auth, (user) => {
        if (user) {
          const uid = user.uid;
          //console.log(user.uid);
          const ref = doc(db, 'Users', uid);

          getDoc(ref).then(user => {
            if (user.exists()) {
              localStorage.setItem('users', JSON.stringify(user.data()));
              //console.log(localStorage.getItem('users'));
              window.location.href = "../Home/home.html";
            } else {
              console.log('Este produto nao existe.');
            }
          });

          updateDoc(ref, {
          //  pick: pick,
            img: img,
            bordercolor: bordercolor,
            imgcolor: imgcolor,
            username: username
          }).then(() => {
            alert("data added sucessfully");
          });

        } else {
          alert("error");
        }

      });
    });
  </script>
</body>

</html>
